{"version":3,"file":"renderer-B2po4HhV.js","sources":["../src/notifications/renderer.ts"],"sourcesContent":["import { handle } from '../ipc/renderer';\n\nconst iconCache = new Map<string, string>();\n\nconst inferContentTypeFromImageData = (data: ArrayBuffer): string | null => {\n  const header = Array.from(new Uint8Array(data.slice(0, 3)))\n    .map((byte) => byte.toString(16))\n    .join('');\n  switch (header) {\n    case '89504e':\n      return 'image/png';\n\n    case '474946':\n      return 'image/gif';\n\n    case 'ffd8ff':\n      return 'image/jpeg';\n\n    default:\n      return null;\n  }\n};\n\nconst fetchIcon = async (urlHref: string): Promise<string> => {\n  const cache = iconCache.get(urlHref);\n\n  if (cache) {\n    return cache;\n  }\n\n  const response = await fetch(urlHref);\n  const arrayBuffer = await response.arrayBuffer();\n  const base64String = btoa(\n    String.fromCharCode(...new Uint8Array(arrayBuffer))\n  );\n  const contentType =\n    inferContentTypeFromImageData(arrayBuffer) ||\n    response.headers.get('content-type');\n  const dataUri = `data:${contentType};base64,${base64String}`;\n  iconCache.set(urlHref, dataUri);\n  return dataUri;\n};\n\nexport default (): void => {\n  handle('notifications/fetch-icon', fetchIcon);\n};\n"],"names":["iconCache","Map","inferContentTypeFromImageData","data","header","Array","from","Uint8Array","slice","map","byte","toString","join","fetchIcon","urlHref","cache","get","response","fetch","arrayBuffer","base64String","btoa","String","fromCharCode","contentType","headers","dataUri","set","handle"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,MAAMA,SAAS,GAAG,IAAIC,GAAG,EAAkB,CAAA;AAE3C,MAAMC,6BAA6B,GAAIC,IAAiB,IAAoB;AAC1E,EAAA,MAAMC,MAAM,GAAGC,KAAK,CAACC,IAAI,CAAC,IAAIC,UAAU,CAACJ,IAAI,CAACK,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CACxDC,GAAG,CAAEC,IAAI,IAAKA,IAAI,CAACC,QAAQ,CAAC,EAAE,CAAC,CAAC,CAChCC,IAAI,CAAC,EAAE,CAAC,CAAA;AACX,EAAA,QAAQR,MAAM;AACZ,IAAA,KAAK,QAAQ;AACX,MAAA,OAAO,WAAW,CAAA;AAEpB,IAAA,KAAK,QAAQ;AACX,MAAA,OAAO,WAAW,CAAA;AAEpB,IAAA,KAAK,QAAQ;AACX,MAAA,OAAO,YAAY,CAAA;AAErB,IAAA;AACE,MAAA,OAAO,IAAI,CAAA;AACf,GAAA;AACF,CAAC,CAAA;AAED,MAAMS,SAAS,GAAG,MAAOC,OAAe,IAAsB;AAC5D,EAAA,MAAMC,KAAK,GAAGf,SAAS,CAACgB,GAAG,CAACF,OAAO,CAAC,CAAA;AAEpC,EAAA,IAAIC,KAAK,EAAE;AACT,IAAA,OAAOA,KAAK,CAAA;AACd,GAAA;AAEA,EAAA,MAAME,QAAQ,GAAG,MAAMC,KAAK,CAACJ,OAAO,CAAC,CAAA;AACrC,EAAA,MAAMK,WAAW,GAAG,MAAMF,QAAQ,CAACE,WAAW,EAAE,CAAA;AAChD,EAAA,MAAMC,YAAY,GAAGC,IAAI,CACvBC,MAAM,CAACC,YAAY,CAAC,GAAG,IAAIhB,UAAU,CAACY,WAAW,CAAC,CACpD,CAAC,CAAA;AACD,EAAA,MAAMK,WAAW,GACftB,6BAA6B,CAACiB,WAAW,CAAC,IAC1CF,QAAQ,CAACQ,OAAO,CAACT,GAAG,CAAC,cAAc,CAAC,CAAA;AACtC,EAAA,MAAMU,OAAO,GAAG,CAAA,KAAA,EAAQF,WAAW,CAAA,QAAA,EAAWJ,YAAY,CAAE,CAAA,CAAA;AAC5DpB,EAAAA,SAAS,CAAC2B,GAAG,CAACb,OAAO,EAAEY,OAAO,CAAC,CAAA;AAC/B,EAAA,OAAOA,OAAO,CAAA;AAChB,CAAC,CAAA;AAED,eAAe,MAAY;AACzBE,EAAAA,iBAAM,CAAC,0BAA0B,EAAEf,SAAS,CAAC,CAAA;AAC/C,CAAC;;;;"}